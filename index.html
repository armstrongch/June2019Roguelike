<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>June 2019 Roguelike</title>
		<style>
			canvas {
				border: 1px solid black;
				display: inline;
			}
		</style>
	</head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<body onload="setupRoom(720, 720)">
		<canvas id="gameCanvas" width="0" height="0"></canvas>
	</body>
	<script>
		var gameCanvas = $("#gameCanvas")[0];
		var ctx = gameCanvas.getContext("2d");
		$("#gameCanvas").mouseup(function(e){handleMouseUp(e);});
		$(document).keydown(function(e){handleKeyUp(e)});
		var spaceSize = 48;
		var playerTurn = false;
		var player;
		var roomNum = 1;
		//Emoji Source
		//https://unicode.org/emoji/charts/full-emoji-list.html
		
		
		function roomObject (xPos, yPos, name, stopsPlayerMovement)
		{
			this.xPos = xPos;
			this.yPos = yPos;
			this.name = name;
			this.stopsPlayerMovement = stopsPlayerMovement;
		}
		var roomObjects =[];
		
		function checkPlayerMovement()
		{
			player.canMoveUp = true;
			player.canMoveDown = true;
			player.canMoveLeft = true;
			player.canMoveRight = true;
			
			var obj;
			for (i = roomObjects.length - 1; i >= 0; i--)
			{
				obj = roomObjects[i];
				if (obj.stopsPlayerMovement)
				{
					if (obj.xPos == player.xPos)
					{
						if (obj.yPos == player.yPos + spaceSize)
						{
							player.canMoveDown = false;
						}
						else if (obj.yPos == player.yPos - spaceSize)
						{
							player.canMoveUp = false;
						}
					}
					else if (obj.yPos == player.yPos)
					{
						if (obj.xPos == player.xPos + spaceSize)
						{
							player.canMoveRight = false;
						}
						else if (obj.xPos == player.xPos - spaceSize)
						{
							player.canMoveLeft = false;
						}
					}
				}
			}
			playerTurn = true;
		}
		
		function setupRoom(roomWidth, roomHeight)
		{
			gameCanvas.width = roomWidth;
			gameCanvas.height = roomHeight;
			
			var playerXPos = 0;
			var playerYPos = 0;
			
			switch(roomNum)
			{
				case 1:
					playerXPos = 7*spaceSize;
					playerYPos = 7*spaceSize;
					for (i = 0; i < gameCanvas.width; i += spaceSize)
					{
						roomObjects.push(new roomObject(i, 0, "tree", true));
						roomObjects.push(new roomObject(i, gameCanvas.height-spaceSize, "tree", true));
					}
					for (i = spaceSize; i < gameCanvas.height - spaceSize; i += spaceSize)
					{
						roomObjects.push(new roomObject(0, i, "tree", true));
						roomObjects.push(new roomObject(gameCanvas.width-spaceSize, i, "tree", true));
					}
					for (i = spaceSize; i < gameCanvas.width - spaceSize; i += spaceSize)
					{
						roomObjects.push(new roomObject(i, spaceSize, "grass", false));
						roomObjects.push(new roomObject(i, gameCanvas.height-(spaceSize*2), "grass", false));
					}
					for (i = (spaceSize*2); i < gameCanvas.height - (spaceSize*2); i += spaceSize)
					{
						roomObjects.push(new roomObject(spaceSize, i, "grass", false));
						roomObjects.push(new roomObject(gameCanvas.width-(spaceSize*2), i, "grass", false));
					}
					break;
			}
			
			player = {
				xPos: playerXPos,
				yPos: playerYPos,
				canMoveUp: true,
				canMoveDown: true,
				canMoveLeft: true,
				canMoveRight: true
			};
			
			drawCanvas();
			checkPlayerMovement();
		}
		
		function handleKeyUp(e)
		{
			if (playerTurn)
			{
				var k = e.keyCode;
				switch (k) {
					case 38: //up
						clickUp();
						break;
					case 40: //down
						clickDown();
						break;	
					case 37: //left
						clickLeft();
						break;	
					case 39: //right
						clickRight();
						break;
				}
			}
		}
		
		function handleMouseUp(e)
		{
			if (playerTurn)
			{
				var canvasOffset = $("#gameCanvas").offset();
				var offsetX = canvasOffset.left;
				var offsetY = canvasOffset.top;
				var spaceXPos = Math.floor(parseInt(e.clientX-offsetX)/spaceSize)*spaceSize;
				var spaceYPos = Math.floor(parseInt(e.clientY-offsetY)/spaceSize)*spaceSize;
				if ((spaceXPos == player.xPos) && (spaceYPos == player.yPos))
				{
					clickPlayer();
				}
				else if ((spaceXPos == player.xPos) && (spaceYPos == player.yPos + spaceSize))
				{
					clickDown();
				}
				else if ((spaceXPos == player.xPos) && (spaceYPos == player.yPos - spaceSize))
				{
					clickUp();
				}
				else if ((spaceXPos == player.xPos + spaceSize) && (spaceYPos == player.yPos))
				{
					clickRight();
				}
				else if ((spaceXPos == player.xPos - spaceSize) && (spaceYPos == player.yPos))
				{
					clickLeft();
				}
			}
		}
		
		function clickPlayer()
		{
			alert("Clicked player!");
		}
		
		function clickUp()
		{
			if (player.canMoveUp)
			{
				player.yPos -= spaceSize;
				var playerTurn = false;
				enemyTurn();
			}
		}
		
		function clickDown()
		{
			if (player.canMoveDown)
			{
				player.yPos += spaceSize;
				var playerTurn = false;
				enemyTurn();
			}
		}
		
		function clickLeft()
		{
			if (player.canMoveLeft)
			{
				player.xPos -= spaceSize;
				var playerTurn = false;
				enemyTurn();
			}
		}
		
		function clickRight()
		{
			if (player.canMoveRight)
			{
				player.xPos += spaceSize;
				var playerTurn = false;
				enemyTurn();
			}
		}
		
		function pointDistance(x1, y1, x2, y2)
		{
			return Math.sqrt((x1-x2)*(x1-x2) + (y1-y2)*(y1-y2));
		}
		
		function drawCanvas()
		{
			ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
			drawBackground();
			drawRoomObjects();
			drawPlayer();
		}
		function drawBackground()
		{
			for (i = 0; i < gameCanvas.width; i += spaceSize)
			{
				ctx.moveTo(0, i);
				ctx.lineTo(gameCanvas.width, i);
				ctx.stroke();
			}
			for (i = 0; i < gameCanvas.height; i += spaceSize)
			{
				ctx.moveTo(i, 0);
				ctx.lineTo(i, gameCanvas.width);
				ctx.stroke();
			} 
		}
		
		function drawPlayer()
		{
			ctx.font = spaceSize*0.7+"px Arial";
			ctx.textAlign = "center";
			ctx.textBaseline = "middle";
			
			ctx.fillText(String.fromCodePoint(0x1F604), 
				player.xPos + spaceSize/2, 
				player.yPos + spaceSize/2);
		}
		
		function drawRoomObjects()
		{
			ctx.font = spaceSize*0.7+"px Arial";
			ctx.textAlign = "center";
			ctx.textBaseline = "middle";
			
			for (i = roomObjects.length - 1; i >= 0; i--)
			{
				var obj = roomObjects[i];
				var objCode;
				switch (obj.name) {
					case "tree":
						objCode = String.fromCodePoint(0x1F333);
						break;
					case "grass":
						objCode = String.fromCodePoint(0x1F33F);
						break;
				}
				ctx.fillText(objCode, 
				obj.xPos + spaceSize/2, 
				obj.yPos + spaceSize/2);
			}
		}
		
		function enemyTurn()
		{
			//move Enemies
			drawCanvas();
			checkPlayerMovement();
		}
	</script>
</html>
